<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <!--<script src='index.js'></script>-->
</head>

<body>
    <script>
        let ws = null;
        let Protocal = null;
        let Host = null;
        let Port = null;

        function hex_to_ascii(str1) {
            var hex = str1.toString();
            var str = '';
            for (var n = 0; n < hex.length; n += 2) {
                str += String.fromCharCode(parseInt(hex.substr(n, 2), 16));
            }
            console.log(str);
            document.getElementById('jsonData').innerHTML = str;

            let date = new Date();
            let timestamp = date.getFullYear() + '/' + date.getMonth() + '/' + (1 + date.getDate()) + "-" + date.getHours() + ":" + date.getMinutes() + ":" + date.getSeconds();

            const JSONlog = document.createElement("p");
            JSONlog.innerHTML = 'Timestamp:' + timestamp + "     " + str;
            document.body.appendChild(JSONlog);
            //return str;
        }

        function sendRegister() {
            ws.send('{"message": "register", "register":"non_ip_data"}');
        }

        function getConfig() {
            ws.send('{"message": "config_get"}');
        }

        function sendMsg() {
            if (document.getElementById('command').value == '')
                document.getElementById('receivedMsg').innerHTML = 'no command';
            else
                ws.send(document.getElementById('command').value);
        }

        function disconnectSocket() {
            ws.close();// close websocket
            document.getElementById('connectStatus').innerHTML = 'Disconnect';
            document.getElementById('receivedMsg').innerHTML = '';
        }

        function connectSocket() {
            ws = new WebSocket(document.getElementById('address').value);// create websocket
            ws.onopen = () => {
                console.log('WebSocket OPEN');// when connect
                document.getElementById('connectStatus').innerHTML = 'Connect';
            };
            ws.onclose = () => {// when disconnect
                console.log('WebSocket CLOSE');
            };
            ws.onerror = err => {// when error
                console.log('WebSocket ERROR');
                console.log(err);
            };
            ws.onmessage = receivedMsg => {// when receive massage
                //console.log(receivedMsg.data);
                let receiveMsgObj = JSON.parse(receivedMsg.data);// string to object
                //console.log(receiveMsgObj.message);
                console.log(typeof (receiveMsgObj));
                document.getElementById('receivedMsg').innerHTML = JSON.stringify(receiveMsgObj);
                if (receiveMsgObj.data)
                    hex_to_ascii(receiveMsgObj.data);
            };

        }
    </script>
    <div>
        <input type="text" id="address" placeholder="ws://localhost:3000" value="ws://192.168.5.146:9000">
        <!--ws://localhost:3000-->
        <button onclick="connectSocket()">Connect Socket</button>
        <button onclick="disconnectSocket()">Disconnect Socket</button>
    </div>
    <div>
        <input type="text" id="command" placeholder="Command">
        <button onclick="sendMsg()">Send Message</button>
        <button onclick="getConfig()">Get Config</button>
        <button onclick="sendRegister()">Send Register</button>
    </div>
    <div id="connectStatus"></div>
    <div id="receivedMsg"></div>
    <div id="jsonData"></div>
</body>

</html>